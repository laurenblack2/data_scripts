import pandas as pd
import numpy as np

study_identifier = 'Study Identifier.csv'
core_id = 'Core.csv'
protocol_file = 'Protocol.csv'

new_study_identifier = 'study1.csv'
new_core_id = 'core1.csv'
new_protocol_file = 'protocol1.csv'

combined = 'combined.csv'

df1 = pd.read_csv(study_identifier, low_memory = False)
col_drop1 = ('date_updated')
df1 = df1.drop(columns = col_drop1)
df1 = df1.astype(str)
df1['fam_id'] = np.where(
    df1['family_id'].str.len() < 5, df1['family_id'].str.zfill(5),""
)
df1 = df1.drop(['family_id'], axis=1)
print(df1.loc[[2]])
df1.to_csv(new_study_identifier, index = False)
print("\nNew study DF created\n")



df2 = pd.read_csv(core_id, low_memory = False)
col_drop2 = ['date_updated','nih_number','date_of_birth','date_of_death','sex','hispanic_or_latino','date_of_initial_contact','proband','contact','mother_id','father_id','marital_status','pregnancy_outcome','pregnancy_outcome_date','multiple_birth','adoption','vital_status','date_of_last_status','deceased','certificate_follow_up','date_requested_death_certificate','report_exclude','informant','relation','mailing','current_age']
df2 = df2.drop(columns = col_drop2)
df2 = df2.astype(str)
df2['fam_id'] = np.where(
    df2['family_id'].str.len() < 5, df2['family_id'].str.zfill(5),""
)
df2 = df2.drop(['family_id'], axis=1)
df2['fsid'] = np.where(
    df2['id'].str.len() < 12, df2['id'].str.zfill(12),""
)
df2 = df2.drop(['id'], axis=1)
print(df2.loc[[2]])
df2.to_csv(new_core_id, index = False)
print("\nNew core DF created\n")


df3 = pd.read_csv(protocol_file, low_memory = False)
col_drop3 = ('date_updated')
df3 = df3.drop(columns = col_drop3)
df3 = df3.astype(str)
df3['fsid'] = np.where(
    df3['id'].str.len() < 12, df3['id'].str.zfill(12),""
)
df3 = df3.drop(['id'], axis=1)
print(df3.loc[[2]])
df3.to_csv(new_protocol_file, index = False)
print("\nNew protocol DF created\n")

# merge_key is to be family id, to be identified (replace merge_key with column name).
df_m1 = pd.merge(df1, df2, on = 'fam_id', how = 'outer')
#df = pd.merge(df_m1, df3, on = 'fsid', how = 'outer')

#df_reorder = df[['fam_id','fsid','study_identifier']]
#df_reorder = df[['fsid', 'fam_id', 'protocol', 'study_identifier']]
lookup_protocol = ['02-C-0210','11-C-0255','02-C-0211','02-C-0052','10-C-N188','02-C-0313','11-C-0034']
#df_filtered = df_reorder.loc[df['protocol'].isin(lookup_protocol)]

#lookup_fsid = ['00075-01-001','00076-01-001','00078-01-001','00085-01-001','00089-01-001','00091-01-001','00093-01-001','00094-01-001','00095-01-001','00116-01-001','00128-01-001','00131-01-001','00132-01-001','00133-01-001','00136-01-001','00137-01-001','00139-01-001','00148-01-001','00153-01-001','00157-01-001','00171-01-001','00194-01-001','00196-01-001','00197-01-001','00198-01-001','00202-01-001','00205-01-001','00208-01-001','00209-01-001','00218-01-001','00222-01-001','00228-01-001','00230-01-001','00232-01-001','00233-01-001','00234-01-001','00235-01-001','00247-01-001','00249-01-001','00250-01-001','00259-01-001','00275-01-001','00282-01-001','00293-01-001','00295-01-001','00296-01-001','00297-01-001','00298-01-001','00299-01-001','00301-01-001','00308-01-001','00314-01-001','00316-01-001','00324-01-001','00326-01-001','00327-01-001','00328-01-001','00331-01-001','00339-01-001','00346-01-001','00351-01-001','00355-01-001','00358-01-001','00361-01-001','00365-01-001','00367-01-001','00369-01-001','00370-01-001','00376-01-001','00390-01-001','00401-01-001','00402-01-001','00407-01-001','00408-01-001','00409-01-001','00427-01-001','00429-01-001','00430-01-001','00431-01-001','00437-01-001','00438-01-001','00441-01-001','00445-01-001','00446-01-001','00447-01-001','00448-01-001','00449-01-001','00450-01-001','00452-01-001','00455-01-001','00474-01-001','00475-01-001','00476-01-001','00485-01-001','00487-01-001','00490-01-001','00492-01-001','00494-01-001','00497-01-001','00510-01-001','00523-01-001','00530-01-001','00534-01-001','00568-01-001','00572-01-001','00595-01-001','00628-01-001','00632-01-001','00634-01-001','00636-01-001','00639-01-001','00643-01-001','00710-01-001','00756-01-001','00766-01-001','00768-01-001','00770-01-001','00785-01-001','00787-01-001','00789-01-001','00790-01-001','00793-01-001','00794-01-001','00798-01-001','00806-01-001','00807-01-001','00810-01-001','00813-01-001','00814-01-001','00834-01-001','00860-01-001','00864-01-001','00877-01-001','00883-01-001','00898-01-001','00902-01-001','00913-01-001','00914-01-001','00921-01-001','00923-01-001','00929-01-001','00990-01-001','01023-01-001','01040-01-001','01090-01-001','01105-01-001','01113-01-001','01118-01-001','01129-01-001','01160-01-001','01161-01-001','01173-01-001','01176-01-001','01177-01-001','01181-01-001','01182-01-001','01183-01-001','01185-01-001','01186-01-001','01431-01-001','01434-01-001','01438-01-001','01458-01-001','01478-01-001','01498-01-001','01499-01-001','01963-01-001','01964-01-001','01977-01-001','02055-01-001','02062-01-001','02065-01-001','02066-01-001','02067-01-001','02069-01-001','02075-01-001','02088-01-001','02094-01-001','02109-01-001','02114-01-001','02117-01-001','02121-01-001','02122-01-001','02128-01-001','02140-01-001','02144-01-001','02145-01-001','02159-01-001','02160-01-001','02164-01-001','02165-01-001','02178-01-001','02180-01-001','02188-01-001','02189-01-001','02212-01-001','02215-01-001','02225-01-001','02227-01-001','02228-01-001','02239-01-001','02253-01-001','02261-01-001','02266-01-001','02268-01-001','02271-01-001','02272-01-001','02276-01-001','02279-01-001','02282-01-001','02293-01-001','02297-01-001','02298-01-001','02299-01-001','02300-01-001','02304-01-001','02305-01-001','02315-01-001','02318-01-001','02322-01-001','02346-01-001','02360-01-001','02364-01-001','02365-01-001','02366-01-001','02376-01-001','02380-01-001','02382-01-001','02394-01-001','02398-01-001','02399-01-001','02400-01-001','02411-01-001','02412-01-001','02426-01-001','02433-01-001','02434-01-001','02461-01-001','02466-01-001','02467-01-001','02470-01-001','02471-01-001','02472-01-001','02473-01-001','02474-01-001','02475-01-001','02476-01-001','02487-01-001','02489-01-001','02492-01-001','02494-01-001','02495-01-001','02496-01-001','02497-01-001','02498-01-001','02500-01-001','02502-01-001','02503-01-001','02504-01-001','02505-01-001','02506-01-001','02507-01-001','02530-01-001','02537-01-001','02538-01-001','02555-01-001','02564-01-001','02566-01-001','02590-01-001','02611-01-001','02623-01-001','02625-01-001','02629-01-001','02632-01-001','02665-01-001','02677-01-001','02736-01-001','02754-01-001','02826-01-001','02850-01-001','02865-01-001','02901-01-001','02903-01-001','02907-01-001','02910-01-001','02912-01-001','02913-01-001','02915-01-001','02916-01-001','02924-01-001','02940-01-001','02993-01-001','02994-01-001','03030-01-001','03034-01-001','03036-01-001','03037-01-001','03067-01-001','03093-01-001','03144-01-001','03153-01-001','03280-01-001','03284-01-001','03286-01-001','03322-01-001','03348-01-001','03349-01-001','03354-01-001','03426-01-001','03432-01-001','03695-01-001','03782-01-001','03836-01-001','03844-01-001','03848-01-001','03910-01-001','03931-01-001','03951-01-001','04048-01-001','04085-01-001','04097-01-001','04127-01-001','04128-01-001','04195-01-001','04249-01-001','04423-01-001']
#df_filtered = df_reorder.loc[df['fsid'].isin(lookup_fsid)]

#df_filtered = df_filtered.drop(df_filtered[df_filtered['study_identifier'] == 'Sarcoma Families'].index)
df_filtered = df_m1.drop(df_m1[df_m1['study_identifier'] == 'Sarcoma Families'].index)
df_filtered.drop_duplicates()
df_filtered.to_csv('test.csv', index = False)

print("\nNew CSV created\n")

